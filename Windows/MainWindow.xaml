<Window
    x:Class="pract_15.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:conv="clr-namespace:pract_15.Converters"
    mc:Ignorable="d"
    Title="Магазин электроники"
    WindowState="Maximized"
    MinHeight="900" MinWidth="900"
    SizeToContent="Width"
   
   
    DataContext="{Binding RelativeSource={RelativeSource Self}}" 
    Style="{StaticResource MMM}">
    <Window.Resources>
        <conv:LowStockConverter x:Key="LowStockConverter"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>



        <!-- ПОИСК -->
        <TextBox Grid.ColumnSpan="2"
                 Grid.Column="1"
                 Margin="0,0,0,10"
                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                 TextChanged="FiltersChanged"
                 x:Name="Searchttt"
                
                 materialDesign:HintAssist.Hint="Поиск по названию"/>

        <!-- ЛЕВАЯ ПАНЕЛЬ -->
        <StackPanel Grid.Row="1">
            <TextBlock Text="Фильтры:" FontSize="16"/>

            <TextBlock Text="По категориям" FontSize="16"/>
            <ComboBox
                x:Name="FiltCat"
                ItemsSource="{Binding Categories,UpdateSourceTrigger=PropertyChanged}"
                      DisplayMemberPath="Name"
                      SelectedItem="{Binding SelectedCategory,UpdateSourceTrigger=PropertyChanged}"
                      SelectionChanged="FiltersChanged"                 
                      Margin="0,5"
               
                      />
            <TextBlock Text="По брендам" FontSize="16"/>
            <ComboBox 
                x:Name="FiltBra"
                ItemsSource="{Binding Brands,UpdateSourceTrigger=PropertyChanged}"                     
                      DisplayMemberPath="Name"
                      TextSearch.TextPath="Name"
                      SelectedItem="{Binding SelectedBrand,UpdateSourceTrigger=PropertyChanged}" 
                         SelectionChanged="FiltersChanged"   
                      Margin="0,5"
                        
                      />

            <TextBlock Text="Цена от" FontSize="16"/>
            <TextBox Text="{Binding PriceFrom, UpdateSourceTrigger=PropertyChanged}" />

            <TextBlock Text="Цена до" FontSize="16"  />
            <TextBox Text="{Binding PriceTo, UpdateSourceTrigger=PropertyChanged}"/>


            <TextBlock Text="Сортировка" FontSize="16" Margin="0,10,0,0"/>

            <ComboBox SelectionChanged="SortChanged">
                <ComboBoxItem Tag="PriceAsc">Цена ↑</ComboBoxItem>
                <ComboBoxItem Tag="PriceDesc">Цена ↓</ComboBoxItem>
                <ComboBoxItem Tag="StockAsc">Количество ↑</ComboBoxItem>
                <ComboBoxItem Tag="StockDesc">Количество ↓</ComboBoxItem>
            </ComboBox>

            <Button Content="Сбросить фильтры"
            Margin="0,10,0,0"
            Click="ResetFilters_Click"/>

            <StackPanel
    Grid.Column="0"
    Orientation="Vertical"
    Margin="0,0,0,10"
    x:Name="ManagerUI"
    Visibility="Collapsed"
   >

                <Button Content="Добавить" Click="AddProduct_Click"/>

                <Button Content="Изменить" Click="EditProduct_Click"/>

                <Button Content="Удалить" Click="DeleteProduct_Click"/>

                <Button Content="Бренды"  Click="Brands_Click"/>

                <Button Content="Категории" Click="Categories_Click"/>
                
                <Button Content="Теги" Click="Tags_Click"/>
            </StackPanel>
        </StackPanel>



        <!-- СПИСОК ТОВАРОВ -->
        <ListView Grid.Row="1"
                  Grid.Column="1"
                  ItemsSource="{Binding Products}"
                  Name="ProductsList">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border Margin="5"
        Padding="10"
        BorderThickness="1"
         Width="450"
        CornerRadius="4"
        BorderBrush="{Binding Stock, Converter={StaticResource LowStockConverter}}">                                                  
                       

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                       
                            <TextBlock Grid.Row="0"
                           Grid.Column="0"
                           Text="{Binding Name}"
                           FontSize="16"
                           FontWeight="SemiBold"/>

                        
                            <TextBlock Grid.Row="0"
                           Grid.Column="1"
                           HorizontalAlignment="Right"
                           Text="{Binding Price, StringFormat='Цена: {0} ₽'}"/>

                          
                            <TextBlock Grid.Row="1"
                           Grid.Column="0">
                    <Run Text="⭐ "/>
                    <Run Text="{Binding Rating}"/>
                            </TextBlock>

                           
                            <TextBlock Grid.Row="2"
                           Grid.Column="0"
                           Text="{Binding Category.Name}"
                           Opacity="0.7"/>

                            <TextBlock Grid.Row="3"
                           Grid.Column="0"
                           Text="{Binding Description}"
                           TextWrapping="Wrap"/>

                     

                            <TextBlock Grid.Row="3"
                           Grid.Column="1"
                           HorizontalAlignment="Right">
                    <Run Text="Остаток: "/>
                    <Run Text="{Binding Stock}"/>
                            </TextBlock>

                            <ItemsControl ItemsSource="{Binding Tags}" Grid.Row="4">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name, StringFormat=#{0}}"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>



                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>



        </ListView>

        <!-- СТАТУС -->
        <WrapPanel Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock Text="{Binding Products.Count, StringFormat='Всего: {0}'}"/>
            <TextBlock Text="{Binding Items.Count, ElementName=ProductsList,
                       StringFormat=' Показано: {0}'}"/>
        </WrapPanel>

        
    </Grid>
</Window>
